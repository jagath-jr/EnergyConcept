<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>History & Undo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="/admin">CMS Dashboard</a>
      <div class="d-flex gap-2">
        <a class="btn btn-outline-light btn-sm" href="/admin/content">Content</a>
        <form action="/admin/logout" method="post">
          <button class="btn btn-outline-light btn-sm" type="submit">Logout</button>
        </form>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <h1 class="h4 mb-3">Change History</h1>

    <% if (error && error.length) { %>
      <div class="alert alert-danger"><%= error[0] %></div>
    <% } %>
    <% if (success && success.length) { %>
      <div class="alert alert-success"><%= success[0] %></div>
    <% } %>

    <form action="/admin/history/undo" method="post" class="mb-3">
      <button class="btn btn-warning" type="submit" <%= history.length ? '' : 'disabled' %>>Undo Latest Change</button>
    </form>

    <div class="card">
      <div class="card-body p-0">
        <table class="table table-striped mb-0">
          <thead>
            <tr>
              <th>Date</th>
              <th>Action</th>
              <th>Section</th>
              <th>Snapshot ID</th>
            </tr>
          </thead>
          <tbody>
            <% if (!history.length) { %>
              <tr><td colspan="4" class="text-center text-muted py-4">No history yet.</td></tr>
            <% } %>
            <% history.forEach(function(item) { %>
              <tr>
                <td><%= new Date(item.createdAt).toLocaleString() %></td>
                <td><%= item.action %></td>
                <td><%= item.section %></td>
                <td><code><%= item.id %></code></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</body>
</html>
